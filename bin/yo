#!/bin/sh
# Simple wrapper to launch sway.

# YIPPIE WAYLAND
export XDG_SESSION_TYPE=wayland
export XDG_SESSION_DESKTOP=sway
export XDG_CURRENT_DESKTOP=sway

# Enable wayland support for a bunch of apps
export MOZ_ENABLE_WAYLAND=1 # Firefox smooth scrolling and zooming LETS GOOOO!
export SDL_VIDEODRIVER=wayland # For SDL2
export _JAVA_AWT_WM_NONREPARENTING=1 # Ew Java, Oh Shiny new Minecraft version!

# GTK+ apps take 20s to start waiting for a portal
# See https://github.com/swaywm/sway/issues/5732
export GTK_USE_PORTAL=0

# DONT ENABLE THIS
# SEE https://github.com/swaywm/sway/wiki/Running-programs-natively-under-wayland#gtk3
# export GDK_BACKEND=wayland

# Electron specific nonsense
export DEFAULT_BROWSER="$BROWSER"

if [ -z "$XDG_RUNTIME_DIR" ]
then
  runtime_dir="/tmp/runtime/$(whoami)"

  mkdir -p "$runtime_dir"
  chmod 700 "$runtime_dir"
  export XDG_RUNTIME_DIR="$runtime_dir"
fi

# Start GNOME keyring
eval $(/usr/bin/gnome-keyring-daemon --start --components=pkcs11,secrets,ssh)
export SSH_AUTH_SOCK

# WOB
export WOBSOCK="$XDG_RUNTIME_DIR/wob.sock"
rm -f $WOBSOCK && mkfifo $WOBSOCK

# Random wallpaper
find ~/pictures/wallpapers -type f | shuf -n 1 > /tmp/wallpaper

exec dbus-run-session sway
